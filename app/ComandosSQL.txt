-- Desde home
CREATE DATABASE vecireport;
USE vecireport;

-- Desde la base de datos vecireport
create table provincias(
    id_provincia int not null PRIMARY KEY AUTO_INCREMENT,
	nombre varchar(50) not null    
);

create table cantones(
    id_canton int not null PRIMARY KEY AUTO_INCREMENT,
    id_provincia int not null,
    nombre varchar(50) not null,
    FOREIGN KEY (id_provincia) REFERENCES provincias(id_provincia)
);

create table usuarios(
    id_usuario int not null PRIMARY KEY AUTO_INCREMENT,
    id_canton int not null,
    nombre varchar(50) not null,
    apellido_1 varchar(50) not null,
    apellido_2 varchar(50) not null,
    correo varchar(60) not null,
    password varchar(200) not null,
    rol varchar(50) not null,
    FOREIGN KEY(id_canton) REFERENCES cantones(id_canton)
);
create table categorias(
    id_categoria int not null PRIMARY KEY AUTO_INCREMENT,
    nombre varchar(30) not null
);

create table reportes(
    id_reporte int not null PRIMARY KEY AUTO_INCREMENT,
    id_usuario int not null,
    id_categoria int not null,
    titulo varchar(30) not null,
    descripcion varchar(200) not null,
    estado varchar(30) not null,
    prioridad varchar (30) not null,
    id_canton INT not null,
    ruta_imagen varchar(100),
    FOREIGN KEY (id_canton) REFERENCES cantones(id_canton),
    FOREIGN KEY(id_usuario) REFERENCES usuarios(id_usuario),
    FOREIGN KEY(id_categoria) REFERENCES categorias(id_categoria)
);

create table encuestas(
    id_encuesta int not null PRIMARY KEY AUTO_INCREMENT,
    titulo varchar(100) not null,
    decripcion varchar(500) not null,
    cantidad_likes int not null,
    cantidad_dislikes int not null,    
    id_usuario int not null,
    FOREIGN KEY(id_usuario) REFERENCES usuarios(id_usuario)
);

create table encuestas_usuarios(
Id_encuesta_usuario int not null primary key auto_increment,
Id_usuario int not null,
Id_encuesta int not null,
FOREIGN KEY(id_usuario) REFERENCES usuarios(id_usuario),
FOREIGN KEY(id_encuesta) REFERENCES encuestas(id_encuesta)
);

CREATE VIEW vista_reportes_activos AS
SELECT 
    r.id_reporte,
    r.titulo,
    r.descripcion,
    r.estado,
    r.ruta_imagen,
    c.nombre AS nombre_canton,
    p.nombre AS nombre_provincia
FROM 
    reportes r
INNER JOIN 
    cantones c ON r.id_canton = c.id_canton
INNER JOIN 
    provincias p ON c.id_provincia = p.id_provincia
WHERE 
    r.estado = 'Aprobada';


-- Inserts necesarios
-- Llenar la tabla de categorias
INSERT INTO `categorias`(`nombre`) VALUES ('Infraestructura');
INSERT INTO `categorias`(`nombre`) VALUES ('Electrica');
INSERT INTO `categorias`(`nombre`) VALUES ('Entorno');
INSERT INTO `categorias`(`nombre`) VALUES ('Natural');

-- Llenar la tabla de provincias
INSERT INTO `provincias` (`nombre`) VALUES ('San José');
INSERT INTO `provincias` (`nombre`) VALUES ('Alajuela');
INSERT INTO `provincias` (`nombre`) VALUES ('Cartago');
INSERT INTO `provincias` (`nombre`) VALUES ('Heredia');
INSERT INTO `provincias` (`nombre`) VALUES ('Guanacaste');
INSERT INTO `provincias` (`nombre`) VALUES ('Puntarenas');
INSERT INTO `provincias` ( `nombre`) VALUES ('Limón');

-- tabla de cantones
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (1, 'San José');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (1, 'Escazú');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (1, 'Desamparados');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (1, 'Puriscal');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (1, 'Tarrazú');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (2, 'Alajuela');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (2, 'San Ramón');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (2, 'Grecia');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (2, 'San Mateo');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (2, 'Atenas');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (3, 'Cartago');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (3, 'Paraíso');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (3, 'La Unión');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (3, 'Jiménez');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (3, 'Turrialba');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (4, 'Heredia');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (4, 'Barva');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (4, 'Santo Domingo');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (4, 'Santa Bárbara');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (4, 'San Rafael');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (5, 'Liberia');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (5, 'Nicoya');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (5, 'Santa Cruz');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (5, 'Bagaces');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (5, 'Carrillo');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (6, 'Puntarenas');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (6, 'Esparza');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (6, 'Buenos Aires');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (6, 'Montes de Oro');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (6, 'Osa');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (7, 'Limón');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (7, 'Pococí');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (7, 'Siquirres');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (7, 'Talamanca');
INSERT INTO `cantones`(`id_provincia`, `nombre`) VALUES (7, 'Matina');

-- Insert para el admin 1 ******LA CONTRASEÑA HASHED ES "admin"
INSERT INTO `usuarios` (`id_usuario`, `id_canton`, `nombre`, `apellido_1`, `apellido_2`, `correo`, `password`, `rol`) VALUES ('1', '1', 'Admin', 'admin1', 'admin1', 'adminvecireport@gmail.com', '$2y$10$Ab8dTWUe29ipfvffg0eyIuPk6hMHeIMaR0FHN1ipSi4of.v1NbDMy', 'Admin');